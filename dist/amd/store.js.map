{"version":3,"sources":["../../src/store.js"],"names":[],"mappings":"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","file":"store.js","sourcesContent":["var _storeCounter = 1;\n\nexport class Store {\n    static decorate(owner, name, dispatcher, handlers) {\n        var store = new Store(name, dispatcher, handlers, null, owner);\n        Object.defineProperties(owner, {\n            _storeDecorator: {\n                configurable: false,\n                writable: false,\n                enumerable: false,\n                value: store\n            },\n            name: {\n                get: store.getName.bind(store),\n                set: store.setName.bind(store)\n            },\n            dispatcher: {\n                get: store.getDispatcher.bind(store),\n                set: store.setDispatcher.bind(store)\n            },\n            dispatch: {\n                configurable: true,\n                writable: true,\n                enumerable: false,\n                value: store.dispatch.bind(store)\n            },\n            waitFor: {\n                configurable: true,\n                writable: true,\n                enumerable: false,\n                value: store.waitFor.bind(store)\n            },\n            destroy: {\n                configurable: true,\n                writable: true,\n                enumerable: false,\n                value: store.destroy.bind(store)\n            }\n        });\n\n        if (owner.initialize instanceof Function) {\n            owner.initialize();\n        }\n    }\n\n    constructor(name, dispatcher = null, handlers = {}, initializeFn = null, handlerContext = null) {\n        this.setName(name);\n        this.setDispatcher(dispatcher);\n\n        this.handlers = new Map();\n\n        for (let [action, handler] of _entries(handlers)) {\n            this.addActionHandler(action, handler);\n        }\n\n        if (initializeFn) {\n            this.initialize = initializeFn.bind(this);\n            this.initialize();\n        }\n\n        this.handlerContext = handlerContext || this;\n    }\n\n    setDispatcher(dispatcher) {\n        if (this.dispatcher && this.dispatcher !== dispatcher) {\n            this.dispatcher.unregister(this.name);\n        }\n        if (dispatcher) {\n            dispatcher.register(this.name, this.callback.bind(this));\n        }\n        this.dispatcher = dispatcher;\n    }\n\n    getDispatcher() {\n        return this.dispatcher;\n    }\n\n    /**\n     * Dispatches an action to the dispatcher defined on this Actions\n     *\n     * @return { Promise } A promise to be resolved when all the callbacks have finised.\n     */\n    dispatch(actionType) {\n        var args = Array.from(arguments);\n        return this.dispatcher.dispatch(actionType, ...args.slice(1));\n    }\n\n    setName(name) {\n        this.name = name;\n    }\n\n    getName() {\n        if (!this.name) {\n            this.name = `luxaflux-store-name-${_storeCounter++}`;\n        }\n        return this.name;\n    }\n\n    /**\n     * Creates a promise and waits for the callbacks specified to complete before resolve it.\n     *\n     * @param  {String<Array>|String} tokens The store tokens to wait for.\n     * @return {Promise} A promise to be resolved when the specified callbacks are completed.\n     */\n    waitFor(tokens) {\n        return this.dispatcher.waitFor(tokens);\n    }\n\n    /**\n     * This is the callback method that needs to be registered with the dispatcher\n     */\n    callback(action) {\n        var handler = this.handlers.get(action);\n        if (handler) {\n            handler.call(this.handlerContext, ...Array.from(arguments).slice(1));\n        }\n    }\n\n    /**\n     * Bind callback to specific action\n     *\n     * @param {Object} callback An object where each key is the name of an action\n     * and the value is the callback to be called when that action is dispatched\n     */\n    addActionHandler(action, handler) {\n        this.handlers.set(action, handler);\n    }\n\n    destroy() {\n        if (this.onDestroy instanceof Function) {\n            this.onDestroy();\n        }\n    }\n}\n\nexport default Store;\n\n// using a generator function\nfunction* _entries(obj) {\n   for (let key of Object.keys(obj)) {\n     yield [key, obj[key]];\n   }\n}\n"]}